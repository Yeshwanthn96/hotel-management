<div class="container">
  <div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <div>
        <h2 class="card-title" style="margin: 0; border: none;">
          {{ authService.isAdmin() ? 'All Bookings Management' : 'My Bookings' }}
        </h2>
        <p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">
          {{ authService.isAdmin() ? 'Manage all customer bookings - Confirm, Hold, or Reject' : 'View and manage your hotel bookings' }}
        </p>
      </div>
      <div style="display: flex; gap: 10px;">
        <select *ngIf="authService.isAdmin()" [(ngModel)]="statusFilter" style="padding: 8px 12px; border-radius: 4px; border: 1px solid #ddd;">
          <option value="ALL">All Status</option>
          <option value="PENDING">Pending</option>
          <option value="CONFIRMED">Confirmed</option>
          <option value="ON_HOLD">On Hold</option>
          <option value="CANCELLED">Cancelled</option>
          <option value="REJECTED">Rejected</option>
          <option value="COMPLETED">Completed</option>
        </select>
        <button *ngIf="!authService.isAdmin()" routerLink="/bookings/add" class="btn btn-primary">+ New Booking</button>
      </div>
    </div>
    
    <div *ngIf="filteredBookings && filteredBookings.length > 0; else emptyState">
      <table>
        <thead>
          <tr>
            <th>Booking ID</th>
            <th *ngIf="authService.isAdmin()">Customer</th>
            <th>Hotel</th>
            <th>Room</th>
            <th>Check-in</th>
            <th>Check-out</th>
            <th>Guests</th>
            <th>Amount</th>
            <th>Status</th>
            <th>Created</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let booking of filteredBookings">
            <td><small>{{booking.id?.substring(0, 8)}}...</small></td>
            <td *ngIf="authService.isAdmin()">
              <div>
                <strong>{{getUserName(booking.userId)}}</strong>
                <br><small style="color: #666;">{{getUserEmail(booking.userId)}}</small>
              </div>
            </td>
            <td><strong>{{getHotelName(booking.hotelId)}}</strong></td>
            <td>{{booking.roomId?.substring(0, 8)}}...</td>
            <td>{{booking.checkInDate | date:'mediumDate'}}</td>
            <td>{{booking.checkOutDate | date:'mediumDate'}}</td>
            <td>{{booking.numberOfGuests}}</td>
            <td><strong>₹{{booking.totalAmount}}</strong></td>
            <td>
              <span [class]="'badge badge-' + getStatusBadgeClass(booking.status || '')">
                {{booking.status}}
              </span>
            </td>
            <td>{{booking.createdAt | date:'short'}}</td>
            <td>
              <!-- Admin Actions -->
              <div *ngIf="authService.isAdmin()" style="display: flex; gap: 5px; flex-wrap: wrap;">
                <button 
                  *ngIf="booking.status === 'PENDING' || booking.status === 'PAYMENT_PENDING'"
                  (click)="confirmBooking(booking)" 
                  class="btn btn-success" 
                  style="padding: 4px 8px; font-size: 11px;">
                  ✓ Confirm
                </button>
                <button 
                  *ngIf="booking.status === 'PENDING' || booking.status === 'PAYMENT_PENDING'"
                  (click)="holdBooking(booking)" 
                  class="btn btn-warning" 
                  style="padding: 4px 8px; font-size: 11px;">
                  ⏸ Hold
                </button>
                <button 
                  *ngIf="booking.status === 'ON_HOLD'"
                  (click)="resumeBooking(booking)" 
                  class="btn btn-info" 
                  style="padding: 4px 8px; font-size: 11px;">
                  ▶ Resume
                </button>
                <button 
                  *ngIf="booking.status === 'PENDING' || booking.status === 'ON_HOLD' || booking.status === 'PAYMENT_PENDING'"
                  (click)="rejectBooking(booking)" 
                  class="btn btn-danger" 
                  style="padding: 4px 8px; font-size: 11px;">
                  ✗ Reject
                </button>
                <button 
                  *ngIf="booking.status === 'CONFIRMED'"
                  (click)="cancelBooking(booking)" 
                  class="btn btn-secondary" 
                  style="padding: 4px 8px; font-size: 11px;">
                  Cancel
                </button>
              </div>
              <!-- User Actions -->
              <div *ngIf="!authService.isAdmin()" style="display: flex; gap: 5px; flex-wrap: wrap;">
                <button 
                  *ngIf="booking.status !== 'CANCELLED' && booking.status !== 'REJECTED' && booking.status !== 'COMPLETED' && booking.status !== 'STAY_COMPLETED'"
                  (click)="cancelBooking(booking)" 
                  class="btn btn-danger" 
                  style="padding: 6px 12px;">
                  Cancel
                </button>
                <button 
                  *ngIf="booking.status === 'STAY_COMPLETED' || booking.status === 'COMPLETED'"
                  [routerLink]="['/reviews/add']"
                  [queryParams]="{hotelId: booking.hotelId, bookingId: booking.id}"
                  class="btn btn-primary" 
                  style="padding: 6px 12px;">
                  ⭐ Write Review
                </button>
                <span *ngIf="booking.status === 'CANCELLED' || booking.status === 'REJECTED'" style="color: #999;">
                  -
                </span>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    
    <ng-template #emptyState>
      <div class="empty-state">
        <h3>{{ authService.isAdmin() ? 'No Bookings Found' : 'No Bookings Yet' }}</h3>
        <p *ngIf="authService.isAdmin()">No customer bookings match the current filter</p>
        <p *ngIf="!authService.isAdmin()">Ready to book your next stay? Browse our hotels and make a reservation</p>
      </div>
    </ng-template>
  </div>
</div>
