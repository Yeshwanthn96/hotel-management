<div class="container">
  <!-- Statistics Cards -->
  <div *ngIf="stats" class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px;">
    <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
      <div style="font-size: 28px; font-weight: bold;">{{stats.totalUsers}}</div>
      <div style="font-size: 12px; opacity: 0.9;">Total Users</div>
    </div>
    <div class="stat-card" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
      <div style="font-size: 28px; font-weight: bold;">{{stats.activeUsers}}</div>
      <div style="font-size: 12px; opacity: 0.9;">Active Users</div>
    </div>
    <div class="stat-card" style="background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
      <div style="font-size: 28px; font-weight: bold;">{{stats.inactiveUsers}}</div>
      <div style="font-size: 12px; opacity: 0.9;">Inactive Users</div>
    </div>
    <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
      <div style="font-size: 28px; font-weight: bold;">{{stats.adminUsers}}</div>
      <div style="font-size: 12px; opacity: 0.9;">Admin Users</div>
    </div>
  </div>

  <div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; flex-wrap: wrap; gap: 15px;">
      <div>
        <h2 class="card-title" style="margin: 0; border: none;">ğŸ‘¥ Users Management</h2>
        <p style="margin: 5px 0 0 0; color: #666; font-size: 14px;">Manage registered users, roles, and access</p>
      </div>
      <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
        <button class="btn btn-primary" (click)="openAddModal()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 10px 20px;">
          â• Add User
        </button>
        <input type="text" placeholder="ğŸ” Search users..." 
               [(ngModel)]="searchTerm" (input)="applyFilters()"
               style="padding: 8px 12px; border-radius: 4px; border: 1px solid #ddd; min-width: 200px;">
        <select [(ngModel)]="statusFilter" (change)="applyFilters()" style="padding: 8px 12px; border-radius: 4px; border: 1px solid #ddd;">
          <option value="ALL">All Status</option>
          <option value="ACTIVE">Active</option>
          <option value="INACTIVE">Inactive</option>
        </select>
        <select [(ngModel)]="roleFilter" (change)="applyFilters()" style="padding: 8px 12px; border-radius: 4px; border: 1px solid #ddd;">
          <option value="ALL">All Roles</option>
          <option value="ADMIN">Admin</option>
          <option value="USER">User</option>
        </select>
      </div>
    </div>
    
    <div *ngIf="filteredUsers && filteredUsers.length > 0; else emptyState">
      <table>
        <thead>
          <tr>
            <th>User</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Role</th>
            <th>Status</th>
            <th>Registered</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of filteredUsers">
            <td>
              <div style="display: flex; align-items: center; gap: 10px;">
                <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                  {{user.firstName?.charAt(0) || 'U'}}{{user.lastName?.charAt(0) || ''}}
                </div>
                <div>
                  <strong>{{user.firstName}} {{user.lastName}}</strong>
                  <br><small style="color: #666;">ID: {{user.id?.substring(0, 8)}}...</small>
                </div>
              </div>
            </td>
            <td>{{user.email || 'N/A'}}</td>
            <td>{{user.phone || 'N/A'}}</td>
            <td>
              <span [class]="'badge ' + getRoleBadgeClass(user.role)">
                {{user.role?.toUpperCase() || 'USER'}}
              </span>
            </td>
            <td>
              <span [class]="'badge ' + getStatusBadgeClass(user.active)">
                {{user.active ? 'Active' : 'Inactive'}}
              </span>
            </td>
            <td>
              <small>{{user.createdAt | date:'mediumDate'}}</small>
            </td>
            <td>
              <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                <button 
                  (click)="toggleUserStatus(user)" 
                  [class]="user.active ? 'btn btn-warning' : 'btn btn-success'"
                  style="padding: 4px 8px; font-size: 11px;">
                  {{user.active ? 'â¸ Deactivate' : 'â–¶ Activate'}}
                </button>
                <button 
                  (click)="changeRole(user)" 
                  class="btn btn-info"
                  style="padding: 4px 8px; font-size: 11px;">
                  {{user.role?.toUpperCase() === 'ADMIN' ? 'ğŸ‘¤ Make User' : 'ğŸ‘‘ Make Admin'}}
                </button>
                <button 
                  (click)="deleteUser(user)" 
                  class="btn btn-danger"
                  style="padding: 4px 8px; font-size: 11px;">
                  ğŸ—‘ Delete
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
      <div style="margin-top: 15px; padding: 10px; background: #f9f9f9; border-radius: 5px; text-align: center; color: #666; font-size: 14px;">
        Showing {{filteredUsers.length}} of {{users.length}} users
      </div>
    </div>
    
    <ng-template #emptyState>
      <div class="empty-state">
        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ‘¥</div>
        <h3>No Users Found</h3>
        <p *ngIf="searchTerm || statusFilter !== 'ALL' || roleFilter !== 'ALL'">Try adjusting your filters</p>
        <p *ngIf="!searchTerm && statusFilter === 'ALL' && roleFilter === 'ALL'">No users registered yet</p>
      </div>
    </ng-template>
  </div>
</div>

<!-- Add User Modal -->
<div *ngIf="showAddModal" class="modal-overlay" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 1000;">
  <div class="modal-content" style="background: white; padding: 30px; border-radius: 12px; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h2 style="margin: 0; color: #333;">â• Add New User</h2>
      <button (click)="closeAddModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">&times;</button>
    </div>
    
    <form (ngSubmit)="addUser()">
      <div style="display: grid; gap: 15px;">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div>
            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">First Name *</label>
            <input type="text" [(ngModel)]="newUser.firstName" name="firstName" required
                   style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;">
          </div>
          <div>
            <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Last Name *</label>
            <input type="text" [(ngModel)]="newUser.lastName" name="lastName" required
                   style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;">
          </div>
        </div>
        
        <div>
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Email *</label>
          <input type="email" [(ngModel)]="newUser.email" name="email" required
                 style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;">
        </div>
        
        <div>
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Phone</label>
          <input type="tel" [(ngModel)]="newUser.phone" name="phone"
                 style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;">
        </div>
        
        <div>
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Password *</label>
          <input type="password" [(ngModel)]="newUser.password" name="password" required minlength="6"
                 style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;">
        </div>
        
        <div>
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Confirm Password *</label>
          <input type="password" [(ngModel)]="newUser.confirmPassword" name="confirmPassword" required
                 style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;">
        </div>
        
        <div>
          <label style="display: block; margin-bottom: 5px; font-weight: 600; color: #333;">Role *</label>
          <select [(ngModel)]="newUser.role" name="role" required
                  style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;">
            <option value="USER">User</option>
            <option value="ADMIN">Admin</option>
          </select>
        </div>
      </div>
      
      <div style="display: flex; gap: 10px; margin-top: 25px; justify-content: flex-end;">
        <button type="button" (click)="closeAddModal()" 
                style="padding: 10px 20px; border: 1px solid #ddd; background: #f5f5f5; border-radius: 6px; cursor: pointer;">
          Cancel
        </button>
        <button type="submit" [disabled]="isLoading"
                style="padding: 10px 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 6px; cursor: pointer;">
          {{ isLoading ? 'Creating...' : 'Create User' }}
        </button>
      </div>
    </form>
  </div>
</div>
